#!/usr/bin/env node
process.env.NODE_ENV = 'development'

// check config
require('../lib/check-config')()

/**
 * program start
 */
const fs = require('fs')
const program = require('commander')
const Server = require('../lib/server')
const utils = require('../lib/utils')
const logger = require('../lib/logger')
const optsFile = utils.cwd('./abc.json')

program
  .option('-p,--port [port]', 'Server port')
  .option('-H,--host [host]', 'Server host')
  .parse(process.argv);

let port = program.port || 7777;
let host = program.host || 'localhost';

let server = new Server(port, host)
server.start(() => {
  fs.watchFile(optsFile, function(cur, prev) {
    logger.log('abc.json has changed!')

    server.resume()
  })
}, true)
